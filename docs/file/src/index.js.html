<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/index.js | lumi-web-core</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Lumi Wallet Core - Web Version"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="lumi-web-core"><meta property="twitter:description" content="Lumi Wallet Core - Web Version"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/lumiwallet/lumi-web-core"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Wrapper.js~Wrapper.html">Wrapper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/index.js~Wallet.html">Wallet</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#class">class</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/class/Core.js~Core.html">Core</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/class/WalletWrapper.js~WalletWrapper.html">WalletWrapper</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#class-bch">class/BCH</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/class/BCH/BitcoinCashTx.js~BitcoinCashTx.html">BitcoinCashTx</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#class-btc">class/BTC</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/class/BTC/BitcoinSync.js~BitcoinSync.html">BitcoinSync</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/class/BTC/BitcoinTx.js~BitcoinTx.html">BitcoinTx</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#class-eth">class/ETH</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/class/ETH/EthereumSync.js~EthereumSync.html">EthereumSync</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/class/ETH/EthereumTx.js~EthereumTx.html">EthereumTx</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#helpers">helpers</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/helpers/handleErrors.js~CustomError.html">CustomError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-calcBtcTxSize">calcBtcTxSize</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-derive">derive</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generateMnemonic">generateMnemonic</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getBtcAddress">getBtcAddress</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getBtcPrivateKeyByIndex">getBtcPrivateKeyByIndex</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getCashAddress">getCashAddress</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getEthAddress">getEthAddress</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getEthAddressByNode">getEthAddressByNode</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getEthPrivateKey">getEthPrivateKey</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getEthPublicKey">getEthPublicKey</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getXprv">getXprv</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-hdFromSeed">hdFromSeed</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-hdFromXprv">hdFromXprv</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-makeRawBchTx">makeRawBchTx</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-makeRawBtcTx">makeRawBtcTx</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-makeRawEthTx">makeRawEthTx</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-mnemonicToEntropy">mnemonicToEntropy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-mnemonicToSeed">mnemonicToSeed</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-privateKeyToWIF">privateKeyToWIF</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-requestHandleErrors">requestHandleErrors</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-toFormatDecimal">toFormatDecimal</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/index.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import Wrapper from &apos;@/Wrapper&apos;
import CustomError from &apos;@/helpers/handleErrors&apos;
import {makeRawBtcTx, makeRawEthTx, makeRawBchTx, getBtcPrivateKeyByIndex} from &apos;@/helpers/coreHelper&apos;

export {default as converter} from &apos;@/helpers/converters&apos;
export {default as toDecimal} from &apos;@/helpers/toFormatDecimal&apos;
export {makeRawBtcTx, makeRawEthTx, makeRawBchTx}

/**
 * Class Wallet
 * @class
 */

export default class Wallet {
  /**
   * Create a Wallet
   * @param {Object} api - A set of URLs for getting information about addresses
   */
  constructor (api) {
    this.wrapper = new Wrapper()
    this.core = null
    this.sync = {}
    this.api = {
      bitcoin: &apos;&apos;,
      bitcoinFee: &apos;&apos;,
      ethereum: &apos;&apos;,
      bitcoinCash: &apos;&apos;
    }
    this._apiReady = false
    
    if (api) {
      this.setApiEndpoint(api)
    }
  }
  
  /**
   * Creating a new wallet
   *
   * @param {number} count - Mnemonic words count
   * @returns {Promise&lt;Object&gt;} An object with core&apos;s information
   * @returns {string} core.mnemonic - Imported mnemonic
   * @returns {string} core.xprv - xprv key
   * @returns {string} core.from - A import type
   * @returns {Object} core.BTC - A BTC core that contains internal and external nodes, private and public keys and the first external user address
   * @returns {Object} core.ETH - A ETH core that contains node, private and public keys and user address
   */
  
  async createNew (count = 12) {
    let data = {
      data: {
        from: &apos;new&apos;,
        count: count
      },
      api: this.api
    }
    
    this.core = await this.wrapper.method(&apos;create&apos;, data)
    
    return this.core
  }
  
  /**
   * Creating a wallet by mnemonic
   *
   * @param {string} mnemonic
   * @returns {Promise&lt;Object&gt;} An object with core&apos;s information
   * @returns {string} core.mnemonic - Imported mnemonic
   * @returns {string} core.xprv - xprv key
   * @returns {string} core.from - A import type
   * @returns {Object} core.BTC - A BTC core that contains internal and external nodes, private and public keys and the first external user address
   * @returns {Object} core.ETH - A ETH core that contains node, private and public keys and user address
   */
  
  async createByMnemonic (mnemonic = &apos;&apos;) {
    if (!mnemonic) {
      throw new CustomError(&apos;err_core_mnemonic_empty&apos;)
    }
    
    let data = {
      data: {
        from: &apos;mnemonic&apos;,
        mnemonic: mnemonic
      },
      api: this.api
    }
    
    this.core = await this.wrapper.method(&apos;create&apos;, data)
    
    return this.core
  }
  
  /**
   * Creating a wallet by xprv key
   *
   * @param {string} key - BIP32 Root Key
   * @returns {Promise&lt;Object&gt;} An object with core&apos;s information
   * @returns {string} core.mnemonic - Imported mnemonic
   * @returns {string} core.xprv - xprv key
   * @returns {string} core.from - A import type
   * @returns {Object} core.BTC - A BTC core that contains internal and external nodes, private and public keys and the first external user address
   * @returns {Object} core.ETH - A ETH core that contains node, private and public keys and user address
   */
  
  async createByKey (key = &apos;&apos;) {
    if (!key) {
      throw new CustomError(&apos;err_core_xprv&apos;)
    }
    
    let data = {
      data: {
        from: &apos;xprv&apos;,
        key: key
      },
      api: this.api
    }
    
    this.core = await this.wrapper.method(&apos;create&apos;, data)
    
    return this.core
  }
  
  /**
   * The method starts synchronization of BTC and ETH
   *
   * @returns {Promise&lt;Object&gt;} An object with sync&apos;s information
   * @returns {Object} sync.BTC - The BTC object contains the addresses used, the list of transactions, the unspent list, the balance in Satoshi, the latest block and the list of commissions
   * @returns {Object} sync.ETH - The ETH object contains the ethereum address, the balance in wei, the list of transactions and gas price
   */
  
  async syncAll () {
    if (!this._apiReady) {
      throw new CustomError(&apos;err_wallet_api&apos;)
    }
    
    await Promise.all([
      this.syncBTC(),
      this.syncETH(),
      this.syncBCH()
    ])
    
    return this.sync
  }
  
  /**
   * The method returns node by derivation path
   *
   * @returns {Promise&lt;Object&gt;} Returns object with node information. Every child node contains the following parameters:
   * derivation path, private key in WIF format, public key in hex, btc and eth address
   * @returns {Object} data
   * @returns {number} sync.from - Top of the derivation range
   * @returns {number} sync.to - End of the derivation range
   * @returns {Object} sync.path - Derivation path. It is contains required parameters (purpose, coin, account) and optional (change, index)
   */
  
  async getChildNodes (data) {
    if (!this.core) {
      throw new CustomError(&apos;err_wallet_exist&apos;)
    }
    
    return await this.wrapper.method(&apos;getNodes&apos;, data)
  }
  
  /**
   * The method starts synchronization of BTC
   *
   * @returns {Promise&lt;Object&gt;} Returns object with bitcoin synchronization information
   * @returns {Object} sync
   * @returns {Object} sync.addresses - Lists of internal, external and empty bitcoin address
   * @returns {Array} sync.transactions - The list of bitcoin transactions
   * @returns {Array} sync.unspent - The list of unspents addresses
   * @returns {number} sync.balance - Bitcoin balance in Satoshi
   * @returns {number} sync.latestBlock - The last block of the bitcoin blockchain
   * @returns {Array} sync.fee - The list of fee per byte
   */
  
  async syncBTC () {
    if (!this._apiReady) {
      throw new CustomError(&apos;err_wallet_api&apos;)
    }
    
    this.sync.BTC = await this.wrapper.method(&apos;sync&apos;, &apos;BTC&apos;)
    
    return this.sync.BTC
  }
  
  /**
   * The method starts synchronization of ETH
   *
   * @returns {Promise&lt;Object&gt;} Returns object with ethereum synchronization information
   * @returns {Object} sync
   * @returns {string} sync.address - Ethereum wallet address
   * @returns {number} sync.balance - Ethereum balance in wei
   * @returns {Array} sync.transactions - The list of ethereum transactions
   * @returns {number} sync.gasPrice - Gas price
   */
  
  async syncETH () {
    if (!this._apiReady) {
      throw new CustomError(&apos;err_wallet_api&apos;)
    }
    
    this.sync.ETH = await this.wrapper.method(&apos;sync&apos;, &apos;ETH&apos;)
    
    return this.sync.ETH
  }
  
  async syncBCH () {
    if (!this._apiReady) {
      throw new CustomError(&apos;err_wallet_api&apos;)
    }
    
    this.sync.BCH = await this.wrapper.method(&apos;sync&apos;, &apos;BCH&apos;)
    
    return this.sync.BCH
  }
  
  /**
   * The method returns a raw BTC transaction
   *
   * @param {Object} data
   * @param {string} data.inputs - List of transaction inputs. Input contains the following parameters:
   * transaction hash, output n, address, value, script and private key in WIF format
   * @param {string} data.outputs - List of transaction outpus. Output contains the following parameters: address and value
   * @returns {Promise&lt;Object&gt;} Returns object with transaction hash and raw transaction data
   * @returns {string} hash - Transaction hash
   * @returns {string} tx - Raw Bitcoin transaction
   */
  
  async makeRawBtcTx (data) {
    return await makeRawBtcTx(data)
  }
  
  /**
   * The method returns a raw BCH transaction
   *
   * @param {Object} data
   * @param {string} data.inputs - List of transaction inputs. Input contains the following parameters:
   * transaction hash, output n, address, value in satoshis, script and private key in WIF format
   * @param {string} data.outputs - List of transaction outpus. Output contains the following parameters: address and value in satoshis
   * @returns {Promise&lt;Object&gt;} Returns object with transaction hash and raw transaction data
   * @returns {string} hash - Transaction hash
   * @returns {string} tx - Raw Bitcoin Cash transaction
   */
  
  async makeRawBchTx (data) {
    return await makeRawBchTx(data)
  }
  
  /**
   * The method returns a raw ETH transaction
   *
   * @param {Object} data
   * @param {string} data.address - Ethereum address
   * @param {number} data.amount - The transaction&apos;s amount in wei
   * @param {number} data.nonce - The transaction&apos;s nonce
   * @param {number} data.gasPrice - The transaction&apos;s gas price in wei
   * @param {number} data.gasLimit - The transaction&apos;s gas limit
   * @param {string} data.privateKey - Private key of ether wallet in hex
   * @returns {Promise&lt;Object&gt;} Returns object with transaction hash and raw transaction data
   * @returns {string} hash - Transaction hash
   * @returns {string} tx - Raw Ethereum transaction
   */
  
  async makeRawEthTx (data) {
    return await makeRawEthTx(data)
  }
  
  /**
   * This method generates a list of transaction fees for the selected currency
   * @param {Object} params
   * @param {Object} params.currency - Selected currency. BTC or ETH
   * @param {Object} params.amount - Amount of transaction
   * @param {Object} params.customFee - Custom fee per byte
   * @param {Object} params.size - Transaction size. Relevant for bitcoin transactions
   * @returns {Promise&lt;Array&gt;} The list of transaction fees
   */
  
  async calculateFee (params) {
    if (!this._apiReady) {
      throw new CustomError(&apos;err_wallet_api&apos;)
    }
    
    let {currency, amount, customFee, size} = params
    
    return await this.wrapper.method(&apos;transaction&apos;, {
      method: &apos;calcFee&apos;,
      currency: currency,
      tx: {
        amount: amount,
        customFee: customFee,
        size: size
      }
    })
  }
  
  /**
   * Wrapper for the compilation of transactions of bitcoin and ether
   * @param {Object} data
   * @param {string} data.currency - Transaction currency
   * @param {Object} data.tx
   * @param {string} data.tx.addressTo - Recipient address
   * @param {number} data.tx.amount - Transaction amount
   * @param {number} data.tx.fee - Transaction fee
   * @returns {Promise&lt;Object&gt;}
   * @returns {string} hash - Transaction hash
   * @returns {string} tx - Raw bitcoin or ethereum transaction
   */
  
  async makeTransaction (data) {
    if (!this._apiReady) {
      throw new CustomError(&apos;err_wallet_api&apos;)
    }
    
    let params = {
      method: &apos;make&apos;,
      currency: data.currency,
      tx: data.tx
    }
    
    return await this.wrapper.method(&apos;transaction&apos;, params)
  }
  
  /**
   * Sets the API Endpoint
   *
   * @type {Object} api
   * @param {string} api.bitcoin - Url address of bitcoin endpoint
   * @param {string} api.bitcoinFee - Url address of bitcoin fee endpoint
   * @param {string} api.ethereum - Url address of ethereum endpoint
   * @param {string} api.bitcoinCash - Url address of bitcoin cash endpoint
   */
  
  setApiEndpoint (api) {
    if (!api || typeof api !== &apos;object&apos; || Array.isArray(api)) {
      throw new CustomError(&apos;err_wallet_api_type&apos;)
    }
    
    for (let key in this.api) {
      if (api.hasOwnProperty(key)) {
        this.api[key] = api[key]
      } else {
        throw Error(`Api must be contains ${ key } value`)
      }
    }
    this._apiReady = true
  }
  
  get Core () {
    return this.core
  }
  
  get getSyncBTC () {
    return this.sync.BTC
  }
  
  get getSyncETH () {
    return this.sync.ETH
  }
  
  get getApiState () {
    return this._apiReady
  }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
